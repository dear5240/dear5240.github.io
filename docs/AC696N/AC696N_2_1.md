# 1. LINEIN_AUX应用

## 1.1. 硬件

AC696N：aux信号进主控信号幅度 vpp不能超过1.2V，因此需要增加电阻分压。检测电阻不能省。

![img61](/pic/61.png)

## 1.2. 概述

LINEI/AUX 功能相应的代码配置，在各板级头文件中

![img62](/pic/62.png)

LINEIN/AUX进来的信号源分为数字通道和模拟通道两种方式，数字通道经过AD采集，模拟通道可以将信号源直接输出到DAC模块。

**模拟通道：**

内部增益放大电路的开关在

```
include_lib\media\media_develop\media\cpu\br25\asm\audio_linein.h
/*
 *linein输入级增益控制，只有0或者1两级
 *0:正常增益
 *1:增益X2
 */
void audio_linein_gain(u8 gain);
```

**数字通道：**

设置linein增益：`int audio_adc_linein_set_gain(struct audio_adc_ch *ch, int gain)`。

**LINEIN或MIC的电压输入范围：**

AC696N：AUX走数字通道支持1.2Vpp（低压），MIC支持0.6Vpp；



## 1.3. 代码

在`app_main.c`中会进入到`app_linein_task();`，该模式用于linein功能

应用端开发重点关注 `..\apps\soundbox\task_manager\linein`文件夹下的源文件，

其中

`linein.c`是主要用于接收按键消息，设备消息，公共消息，根据相应的消息进行处理

`linein_api.c`提供了音量加减，模拟增益设置等api接口

`linein_dev.c`提供linein插入检测功能的api接口

在路径`..\cpu\br25\audio_dec中audio_dec_linein.c`和`audio_dec_linein.h`用于开启linein的数字通道的解码模块



## 1.4. 常见问题

**1. AC696linein使用限制**

AC696只有一路ADC，所以不能同时使用linein双声道ADC输入，需要立体声时只能走模拟通道，但模拟调不了EQ；

FM 与 LINEIN 复用未使能，不可选择AUDIO_LIN1R_CH，同时也是不能使用AUDIO_LIN1_LR，当fm和linein复用时，linein接在fm引脚；

以上两点如果不注意，就会导致程序复位。

关于FM 与 LINEIN 复用 功能注意点：

- FM 与 LINEIN 复用 必须使用ADC 数字输入的方式。
- FM 与 LINEIN 复用，并且在蓝牙模式下，同时开启linein功能混合输出，打开linein的动作需要在蓝牙初始化完成后调用，不然会导致没有声音。

**2. linein使用注意点**

1. 当要使用频谱，频响或者其他算法功能时需要注意程序是否配置为数字输入，模拟输入无法获得数据去处理，特别是AC696一定要注意上文第一点去使用。
1. linein尽可能不要与其他功能做IO口复用，能避免各类检测概率出错问题。

